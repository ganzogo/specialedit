(function(a){a.fn.specialedit=function(d,b){var e=16;var f="&#223;";var c={toolbarBgColor:"#f0f0ee",toolbarBorderColor:"#cccccc",buttonBgColor:"#b2bbd0",buttonBorderColor:"#000000",buttonTextColor:"#000000",buttonWidth:20,buttonHeight:20,buttonMargin:3};if(b){a.extend(c,b)}return this.each(function(){var k=a(this);var h=false;var j=new Array();var m=k.offset().top+k.outerHeight()+5;var l=k.offset().left+k.outerWidth()-2;var i=a("<div/>").css("position","absolute").css("left",(l-(d.length*(c.buttonWidth+c.buttonMargin+2))-c.buttonMargin)+"px").css("top",m+"px").css("display","none").css("border","1px solid "+c.toolbarBorderColor).css("width",((d.length*(c.buttonWidth+c.buttonMargin+2))+c.buttonMargin)+"px").css("height",((c.buttonHeight+(2*(c.buttonMargin+1)))+"px")).css("background",c.toolbarBgColor).mouseover(function(){h=true}).mouseout(function(){h=false}).click(function(){k.focus()});a.each(d,function(n,o){j[n]=a("<div/>").html(o).css("width",c.buttonWidth+"px").css("height",(c.buttonHeight-(c.buttonHeight/2)+9)+"px").css("color",(c.buttonTextColor)).css("border","0").css("text-align","center").css("cursor","pointer").css("top",c.buttonMargin+"px").css("left",(((c.buttonWidth+c.buttonMargin+2)*n)+c.buttonMargin)+"px").css("border","1px solid "+c.toolbarBgColor).css("padding-top",((c.buttonHeight/2)-8)+"px").css("position","absolute").mouseover(function(){a(this).css("border","1px solid "+c.buttonBorderColor).css("background",c.buttonBgColor)}).mouseout(function(){a(this).css("border","1px solid "+c.toolbarBgColor).css("background",c.toolbarBgColor)}).mousedown(function(){var p=k[0];var s=g(a(this).html());if(document.selection){p.focus();sel=document.selection.createRange();sel.text=s;p.focus()}else{if(p.selectionStart||p.selectionStart=="0"){var r=p.selectionStart;var q=p.selectionEnd;var t=p.scrollTop;p.value=p.value.substring(0,r)+s+p.value.substring(q,p.value.length);p.focus();p.selectionStart=r+s.length;p.selectionEnd=r+s.length;p.scrollTop=t}else{p.value+=s;p.focus()}}});i.append(j[n])});k.after(i);function g(n){return a("<div/>").html(n).text()}k.bind("keydown.specialedit",function(n){if(n.which==e){for(var o in j){if(j[o].html()!=g(f)){j[o].html(j[o].html().toUpperCase())}}}});k.bind("keyup.specialedit",function(n){if(n.which==e){for(var o in j){j[o].html(j[o].html().toLowerCase())}}});k.bind("focus.specialedit",function(){i.fadeIn()});k.bind("blur.specialedit",function(){if(!h){i.hide()}})})}})(jQuery);